{
    "rules": [
        {
            "name": "global_ddos_protect",
            "scope": "global",
            "conditions": [
                {
                    "type": "global_request_rate",
                    "config": {
                        "threshold": 100,
                        "unit": "second",
                        "operator": ">"
                    }
                }
            ],
            "actions": [
                { "name": "rate_limit_api", "stop": false },
                { "name": "dyn_temp_ban_api", "stop": true }
            ]
        },
        {
            "name": "rate_limit_rule",
            "scope": "route",
            "conditions": [
                {
                    "type": "request_count",
                    "config": {
                        "uri": "/api/",
                        "methods": [ "GET", "POST" ],
                        "threshold": 1,
                        "unit": "second",
                        "operator": ">"
                    }
                }
            ],
            "actions": [
                { "name": "rate_limit_api", "override": { "response": { "status_code": 429, "body": "Too Many Requests" } }, "stop": false }
            ]
        },
        {
            "name": "admin_restriction_rule",
            "scope": "route",
            "conditions": [
                {
                    "type": "request_count",
                    "config": {
                        "uri": "/api/admin/",
                        "methods": [ "GET", "POST" ],
                        "threshold": 2,
                        "unit": "second",
                        "operator": ">"
                    }
                }
            ],
            "actions": [
                { "name": "restrict_admin", "stop": true },
                { "name": "warning_admin", "stop": false }
            ]
        },
        {
            "name": "mitm_global_detect",
            "scope": "global",
            "conditions": [
                {
                    "type": "mitm_suspect",
                    "config": { }
                }
            ],
            "actions": [
                { "name": "dyn_temp_ban_api", "stop": true },
                { "name": "drop_connection", "stop": true }
            ]
        },
        {
            "name": "secure_route_tls_required",
            "scope": "route",
            "conditions": [
                { "type": "path_prefix", "config": { "prefix": "/secure" } },
                { "type": "mitm_suspect", "config": { } }
            ],
            "actions": [ { "name": "restrict_admin", "stop": true } ]
        },
        {
            "name": "header_block_bad_ua",
            "scope": "route",
            "conditions": [
                { "type": "path_prefix", "config": { "prefix": "/api/" } },
                { "type": "header_equals", "config": { "header": "User-Agent", "value": "BadBot" } }
            ],
            "actions": [ { "name": "drop_connection", "stop": true } ]
        },
        {
            "name": "admin_header_required",
            "scope": "route",
            "conditions": [
                { "type": "path_prefix", "config": { "prefix": "/api/admin/" } },
                { "type": "header_equals", "config": { "header": "X-Admin-Token", "value": "secret-token" } }
            ],
            "actions": [ { "name": "restrict_admin", "stop": true } ]
        },
        {
            "name": "block_private_net",
            "scope": "global",
            "conditions": [
                { "type": "ip_in", "config": { "ips": [ "10.0.0.0/8", "192.168.0.0/16" ] } }
            ],
            "actions": [ { "name": "perm_ban_block", "stop": true } ]
        }
    ],
    "actions": [
        {
            "type": "rate_limit",
            "name": "rate_limit_api",
            "config": { "base_delay": 5, "jitter_range": 2000 },
            "response": { "status_code": 429, "body": "Too Many Requests" }
        },
        {
            "type": "temp_ban",
            "name": "temp_ban_api",
            "config": { "duration": "1m" },
            "response": { "status_code": 429, "body": "Temporarily Banned" }
        },
        {
            "type": "dyn_temp_ban",
            "name": "dyn_temp_ban_api",
            "config": { "base_duration": "30s" },
            "response": { "status_code": 429, "body": "Temporarily Banned" }
        },
        {
            "type": "restrict",
            "name": "restrict_admin",
            "config": { },
            "response": { "status_code": 403, "body": "Access Restricted" }
        },
        {
            "type": "warning",
            "name": "warning_admin",
            "config": { },
            "response": { "status_code": 200, "body": "Warning Logged" }
        },
        {
            "type": "drop_conn",
            "name": "drop_connection",
            "config": { },
            "response": { }
        },
        {
            "type": "perm_ban",
            "name": "perm_ban_block",
            "config": { },
            "response": { "status_code": 403, "body": "Blocked" }
        }
    ],
    "tcp_listen": "",
    "tcp_rules": [
        {
            "name": "tcp_conn_rate_rule",
            "conditions": [
                {
                    "type": "conn_rate",
                    "config": { "threshold": 5, "unit": "second", "operator": ">" }
                }
            ],
            "actions": [ { "name": "drop_connection", "stop": true }, { "name": "dyn_temp_ban_api", "stop": true } ]
        },
        {
            "name": "tcp_concurrent_rule",
            "conditions": [
                {
                    "type": "concurrent_conn",
                    "config": { "threshold": 10, "per_ip": true, "operator": ">=" }
                }
            ],
            "actions": [ { "name": "dyn_temp_ban_api", "stop": true } ]
        },
        {
            "name": "tcp_global_concurrent_rule",
            "conditions": [
                {
                    "type": "concurrent_conn",
                    "config": { "threshold": 50, "per_ip": false, "operator": ">=" }
                }
            ],
            "actions": [ { "name": "drop_connection", "stop": true } ]
        }
    ]
}
