{
    "name": "regionalAccessControl",
    "type": "pipeline",
    "enabled": true,
    "priority": 70,
    "pipeline": {
        "nodes": [
            {
                "id": "check_endpoint",
                "type": "utility",
                "function": "checkEndpoint",
                "params": {
                    "endpoint": "/api/login"
                }
            },
            {
                "id": "get_ip",
                "type": "utility",
                "function": "getClientIP"
            },
            {
                "id": "get_country",
                "type": "utility",
                "function": "getCountryFromIP",
                "params": {
                    "defaultCountry": "US"
                }
            },
            {
                "id": "check_region",
                "type": "condition",
                "function": "checkBusinessRegion",
                "params": {
                    "endpoint": "/api/login",
                    "allowedCountries": [ "US", "CA", "GB" ],
                    "deniedCountries": [ "RU", "CN", "IR" ]
                }
            }
        ],
        "edges": [
            { "from": "check_endpoint", "to": "get_ip" },
            { "from": "get_ip", "to": "get_country" },
            { "from": "get_country", "to": "check_region" }
        ],
        "combination": "OR"
    },
    "actions": [
        {
            "type": "temporary_ban",
            "priority": 10,
            "duration": "1h",
            "response": {
                "status": 403,
                "message": "Login restricted to supported regions."
            },
            "notify": {
                "channel": "slack",
                "topic": "security",
                "message": "Blocked login from {{clientIP}} ({{get_country}})."
            }
        },
        {
            "type": "rate_limit",
            "priority": 5,
            "limit": "2 rpm",
            "response": {
                "status": 429,
                "message": "Geo-restricted login attempts slowed."
            }
        }
    ]
}
