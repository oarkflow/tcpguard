{
    "anomalyDetectionRules": {
        "global": {
            "ddosDetection": {
                "enabled": true,
                "params": {
                    "window": "60s",
                    "attacks": {
                        "icmp_flood": { "thresholds": { "rate": 120, "bandwidth": 15728640 } },
                        "ip_fragmentation": { "thresholds": { "failure_ratio": 0.3 } },
                        "smurf_attack": { "thresholds": { "responses": 1000, "amplification": 120 } },
                        "syn_flood": { "thresholds": { "rate": 120, "completion_ratio": 0.1, "half_open": 60 } },
                        "ack_flood": { "thresholds": { "rate": 500, "ack_ratio": 0.8 } },
                        "rst_fin_flood": { "thresholds": { "rst_rate": 100, "rst_ratio": 0.5 } },
                        "udp_flood": { "thresholds": { "rate": 1000, "bandwidth": 10485760 } },
                        "tcp_connection_flood": { "thresholds": { "active": 120, "rate": 60 } },
                        "http_flood": { "thresholds": { "request_rate": 120, "path_diversity": 0.1 } },
                        "slowloris": { "thresholds": { "duration": 60, "connection_count": 10 } },
                        "slow_post": { "thresholds": { "transfer_rate": 100, "gap": 30 } },
                        "http_header_flood": { "thresholds": { "header_size": 32768, "header_count": 100 } },
                        "cache_bypass": { "thresholds": { "randomness": 0.5 } },
                        "xml_json_bomb": { "thresholds": { "payload_size": 10485760, "depth": 20 } },
                        "api_abuse": { "thresholds": { "call_rate": 100, "exec_time": 10 } },
                        "tls_renegotiation": { "thresholds": { "renegotiations": 10 } },
                        "tls_handshake_flood": { "thresholds": { "client_hello": 50, "completion_ratio": 0.2 } },
                        "http2_rapid_reset": { "thresholds": { "stream_rate": 100, "reset_ratio": 0.8 } },
                        "websocket_flood": { "thresholds": { "connections": 50, "message_rate": 1000 } },
                        "dns_amplification": { "thresholds": { "query_rate": 100, "amplification": 50 } },
                        "ntp_amplification": { "thresholds": { "monlist": 10, "response_size": 1000 } },
                        "snmp_amplification": { "thresholds": { "getbulk": 50 } },
                        "memcached_amplification": { "thresholds": { "udp_requests": 10, "amp_factor": 10000 } },
                        "bandwidth_saturation": { "thresholds": { "total_bandwidth": 0.8 } },
                        "pps_attack": { "thresholds": { "per_ip_pps": 10000 } },
                        "connection_table_exhaustion": { "thresholds": { "usage": 0.9 } },
                        "memory_exhaustion": { "thresholds": { "usage": 0.9, "growth_rate": 100 } },
                        "cpu_exhaustion": { "thresholds": { "cpu_usage": 90 } },
                        "fd_exhaustion": { "thresholds": { "usage": 0.9 } },
                        "redos_attack": { "thresholds": { "exec_time": 5 } },
                        "graphql_complexity": { "thresholds": { "depth": 10 } },
                        "sql_dos": { "thresholds": { "exec_time": 30 } },
                        "range_request_attack": { "thresholds": { "range_count": 100 } },
                        "compression_bomb": { "thresholds": { "ratio": 1000 } },
                        "web_scraping": { "thresholds": { "crawl_rate": 30 } },
                        "credential_stuffing": { "thresholds": { "login_rate": 50, "failure_ratio": 0.9 } },
                        "account_enumeration": { "thresholds": { "lookup_rate": 20 } },
                        "session_exhaustion": { "thresholds": { "session_rate": 100 } },
                        "resource_locking": { "thresholds": { "lock_rate": 50 } },
                        "email_bomb": { "thresholds": { "send_rate": 100, "recipients": 1000 } }
                    }
                },
                "actions": [
                    {
                        "type": "rate_limit",
                        "limit": "50 rpm",
                        "response": {
                            "status": 429,
                            "message": "Too many global requests. Please slow down."
                        }
                    },
                    {
                        "type": "temporary_ban",
                        "duration": "10m",
                        "response": {
                            "status": 403,
                            "message": "Temporary ban due to suspected DDoS activity."
                        }
                    }
                ]
            },
            "mitmDetection": {
                "enabled": true,
                "indicators": [
                    "invalid_ssl_certificate",
                    "abnormal_tls_handshake",
                    "suspicious_user_agent"
                ],
                "actions": [
                    {
                        "type": "permanent_ban",
                        "response": {
                            "status": 403,
                            "message": "Connection blocked due to security concerns (MITM detected)."
                        }
                    }
                ]
            },
            "rules": {
                "businessHours": {
                    "type": "pipeline",
                    "enabled": true,
                    "pipeline": {
                        "nodes": [
                            {
                                "id": "check_endpoint",
                                "type": "utility",
                                "function": "checkEndpoint",
                                "params": {
                                    "endpoint": "/api/login"
                                }
                            },
                            {
                                "id": "get_time",
                                "type": "utility",
                                "function": "getCurrentTime"
                            },
                            {
                                "id": "parse_start",
                                "type": "utility",
                                "function": "parseTime",
                                "params": {
                                    "timeString": "09:00",
                                    "layout": "15:04"
                                }
                            },
                            {
                                "id": "parse_end",
                                "type": "utility",
                                "function": "parseTime",
                                "params": {
                                    "timeString": "17:00",
                                    "layout": "15:04"
                                }
                            },
                            {
                                "id": "check_hours",
                                "type": "condition",
                                "function": "checkBusinessHours",
                                "params": {
                                    "timezone": "UTC"
                                }
                            }
                        ],
                        "edges": [
                            { "from": "check_endpoint", "to": "get_time" },
                            { "from": "get_time", "to": "parse_start" },
                            { "from": "parse_start", "to": "parse_end" },
                            { "from": "parse_end", "to": "check_hours" }
                        ]
                    },
                    "actions": [
                        {
                            "type": "temporary_ban",
                            "duration": "1h",
                            "response": {
                                "status": 403,
                                "message": "Login attempted outside business hours."
                            }
                        }
                    ]
                },
                "businessRegion": {
                    "type": "pipeline",
                    "enabled": true,
                    "pipeline": {
                        "nodes": [
                            {
                                "id": "check_endpoint",
                                "type": "utility",
                                "function": "checkEndpoint",
                                "params": {
                                    "endpoint": "/api/login"
                                }
                            },
                            {
                                "id": "get_ip",
                                "type": "utility",
                                "function": "getClientIP"
                            },
                            {
                                "id": "get_country",
                                "type": "utility",
                                "function": "getCountryFromIP",
                                "params": {
                                    "defaultCountry": "US"
                                }
                            },
                            {
                                "id": "check_region",
                                "type": "condition",
                                "function": "checkBusinessRegion",
                                "params": {
                                    "allowedCountries": [ "US", "CA" ]
                                }
                            }
                        ],
                        "edges": [
                            { "from": "check_endpoint", "to": "get_ip" },
                            { "from": "get_ip", "to": "get_country" },
                            { "from": "get_country", "to": "check_region" }
                        ]
                    },
                    "actions": [
                        {
                            "type": "temporary_ban",
                            "duration": "1h",
                            "response": {
                                "status": 403,
                                "message": "Login attempted from unauthorized region."
                            }
                        }
                    ]
                },
                "protectedRoute": {
                    "type": "pipeline",
                    "enabled": true,
                    "pipeline": {
                        "nodes": [
                            {
                                "id": "check_protected",
                                "type": "condition",
                                "function": "checkProtectedRoute",
                                "params": {
                                    "protectedRoutes": [ "/api/protected" ],
                                    "loginCheckHeader": "Authorization"
                                }
                            }
                        ],
                        "edges": [ ]
                    },
                    "actions": [
                        {
                            "type": "rate_limit",
                            "response": {
                                "status": 401,
                                "message": "Unauthorized access to protected route."
                            }
                        }
                    ]
                },
                "sessionHijacking": {
                    "type": "pipeline",
                    "enabled": true,
                    "pipeline": {
                        "nodes": [
                            {
                                "id": "check_session",
                                "type": "condition",
                                "function": "checkSessionHijacking",
                                "params": {
                                    "maxConcurrentSessions": 1,
                                    "sessionTimeout": "24h"
                                }
                            }
                        ],
                        "edges": [ ]
                    },
                    "actions": [
                        {
                            "type": "temporary_ban",
                            "duration": "30m",
                            "response": {
                                "status": 403,
                                "message": "Session hijacking detected."
                            }
                        }
                    ]
                }
            }
        },
        "apiEndpoints": {
            "/api/login": {
                "rateLimit": {
                    "requestsPerMinute": 5,
                    "burst": 2
                },
                "actions": [
                    {
                        "type": "jitter_warning",
                        "jitterRangeMs": [ 500, 2000 ],
                        "response": {
                            "status": 429,
                            "message": "Too many login attempts. Please wait a moment."
                        }
                    },
                    {
                        "type": "temporary_ban",
                        "duration": "15m",
                        "trigger": {
                            "key": "failedLogins",
                            "threshold": 5,
                            "within": "2m"
                        },
                        "response": {
                            "status": 403,
                            "message": "You are temporarily banned due to excessive failed logins."
                        }
                    }
                ]
            },
            "/api/data/export": {
                "rateLimit": {
                    "requestsPerMinute": 3
                },
                "actions": [
                    {
                        "type": "rate_limit",
                        "limit": "3 rpm",
                        "response": {
                            "status": 429,
                            "message": "Rate limit exceeded for data export API."
                        }
                    },
                    {
                        "type": "jitter_warning",
                        "jitterRangeMs": [ 1000, 5000 ],
                        "response": {
                            "status": 429,
                            "message": "You are making export requests too frequently."
                        }
                    }
                ]
            }
        }
    }
}
